{% extends 'base.html' %}

{% block title %}Панель управления{% endblock %}

{% block content %}
<div>
    <h1>Панель управления</h1>

    <div>
        <div>
            <h3>Всего заказов</h3>
            <p>{{ total_orders }}</p>
        </div>
        <div>
            <h3>Оплаченных заказов</h3>
            <p>{{ paid_orders }}</p>
        </div>
        <div>
            <h3>Принятых заказов</h3>
            <p>{{ accepted_orders }}</p>
        </div>
    </div>

    <div>
        <div>
            <h3>Топ клиентов</h3>
            <div>
                {% if top_clients %}
                <div>
                    <table>
                        <thead>
                            <tr>
                                <th>Компания</th>
                                <th>Сумма заказов</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for client in top_clients %}
                            <tr>
                                <td>{{ client.company_name }}</td>
                                <td>{{ client.total_orders|default:"0" }} руб.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p>Нет данных о клиентах</p>
                {% endif %}
            </div>
        </div>

        <div>
            <h3>Доступные заказы</h3>
            <div>
                {% if recent_orders %}
                <div>
                    <table>
                        <thead>
                            <tr>
                                <th>№</th>
                                <th>Компания</th>
                                <th>Продукция</th>
                                <th>Количество</th>
                                <th>Месяц</th>
                                <th>Дата заказа</th>
                                <th>Дата выполнения</th>
                                <th>Статус</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in recent_orders %}
                            <tr>
                                <td>{{ order.id }}</td>
                                <td>{{ order.client.company_name }}</td>
                                <td>{{ order.product.name }}</td>
                                <td>{{ order.quantity }}</td>
                                <td>{{ order.month|date:'F Y' }}</td>
                                <td>{{ order.order_date }}</td>
                                <td>{{ order.completion_date|default:'-' }}</td>
                                <td>{{ order.get_status_display }}</td>
                                <td>
                                    <a href="{% url 'catalog:order_detail' order_id=order.id %}">
                                        Подробнее
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p>Нет заказов</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}